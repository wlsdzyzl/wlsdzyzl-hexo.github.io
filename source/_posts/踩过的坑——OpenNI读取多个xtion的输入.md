---
title: 踩过的坑——OpenNI读取多个xtion的输入
date: 2019-7-12 00:00:00
tags: [OpenNI,xtion]
categories: 踩过的坑
mathjax: true
---    
    
最近项目需要将单个相机拓展到多个相机阵列，使用的相机是xtion，因此首先要做的一步就是将多个相机的输入都能读取到。

<!--more-->


我之前是没有用过OpenNI的，OpenNI是一个开源的对kinect, xtion等设备进行操作的驱动c++库。仔细观察了一下原来的代码中，获取设备是通过`openni::ANY_DEVICE`这么一个常量来获取的。经过查阅后发现，这个常量非常会使得系统连接所有的设备，如果恰好计算机只连接了一台xtion或者kinect，那么这个就非常有用。

但是现在的问题是我需要连接多个，不过这个也不是什么难事，OpenNI提供了一个`OpenNI::enumerateDevices()`来获取所有可用的设备列表，存取到`Array<DeviceInfo>`类型的数组中，然后我们可用通过调用`DeviceInfo::getUri()`来获取设备的uri，传入`Device::Open`即可打开对应的设备。

<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">initOpenNI</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span> &gt; &amp;devicesURI)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    openni::Status rc = openni::OpenNI::initialize();</span><br><span class="line">    <span class="keyword">if</span>(rc != openni::STATUS_OK)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    </span><br><span class="line">    openni::Array&lt;openni::DeviceInfo&gt; aDeviceList;  </span><br><span class="line">    openni::OpenNI::enumerateDevices( &amp;aDeviceList );</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">"Now we have detected "</span>&lt;&lt;aDeviceList.getSize()&lt;&lt;<span class="string">" devices! "</span>&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; aDeviceList.getSize(); ++ i )  </span><br><span class="line">    {    </span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"device "</span> &lt;&lt; i &lt;&lt;<span class="string">":"</span>&lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;    </span><br><span class="line">        <span class="keyword">const</span> openni::DeviceInfo&amp; rDevInfo = aDeviceList[i];    </span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">string</span> name =   rDevInfo.getName() ;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Name: "</span> &lt;&lt; name &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"UsbProductID： "</span> &lt;&lt;  rDevInfo.getUsbProductId() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Vendor： "</span>&lt;&lt; rDevInfo.getVendor() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;     </span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"UsbVendorId: "</span> &lt;&lt; rDevInfo.getUsbVendorId() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;    </span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"URI: "</span> &lt;&lt; rDevInfo.getUri() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;     </span><br><span class="line">        <span class="keyword">if</span>(name == <span class="string">"PS1080"</span>)</span><br><span class="line">        devicesURI.push_back(rDevInfo.getUri());</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table>

上面的例子中，因为我使用的相机全是xtion，而xtion在设备信息中显示的名称是PS1080，因此就用这个，来得到相机对应的uri。
