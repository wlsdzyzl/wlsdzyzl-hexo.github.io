---
title: ROS——Client Library(含代码实例)
date: 2019-10-08 00:00:00
tags: [ros]
categories: ROS
mathjax: true
---        
为了更好的使用ROS编程，ROS提供了Client Library，也就是一个编程库，可以用来建立node，发布消息，调用服务等等。其中有cpp版本的roscpp，python版本的rospy，还有lisp版本的roslisp，但是显然我们用的最多的是cpp与python版本。这里会编写一些简单的通信实例，以得到更好的学习效果。

<!--more-->


[](about:blank#roscpp "roscpp")roscpp
-------------------------------------

先介绍一些用cpp编写的通信实例，这些过程都很简单，实际上在[ros/tutorials](http://wiki.ros.org/ROS/Tutorials)上都有更清晰的介绍。

### [](about:blank#Topic "Topic")Topic

首先编写一个简单的发布/订阅实例。最基本的，是在workspace中建立package。在建立package时，我们还可以在包名后添加依赖：  

<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">catkin_create_pkg topic_demo rospy roscpp std_msgs</span><br></pre></td></tr></tbody></table>

建立好package之后新建目录src，msg，分别用来存放源代码与msg格式。我们首先定义消息的格式，这里命名为gps.msg，也就是发送的是位置信息，包含坐标和状态：  

<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># content of gps.msg</span><br><span class="line">float32 x</span><br><span class="line">float32 y</span><br><span class="line">string state</span><br></pre></td></tr></tbody></table>

这样我们就定义了一个非常简单的Message。在编译之后，catkin会在devel/include/topic\_demo目录下生成一个gps.h文件，这个是我们实际上之后要使用的头文件。

接着，在src中，我们创建talker.cpp，与listener.cpp，分别编写publisher和subscriber的node。实际上这些代码看起来也很容易理解：  

<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//talker.cpp</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;topic_demo/gps.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	ros::init(argc,argv,<span class="string">"talker"</span>);</span><br><span class="line">	ros::NodeHandle nh;</span><br><span class="line">	topic_demo::gps msg;</span><br><span class="line">	msg.x = <span class="number">1.0</span>;</span><br><span class="line">	msg.y = <span class="number">1.0</span>;</span><br><span class="line">	msg.state = <span class="string">"working"</span>;</span><br><span class="line">	ros::Publisher pub = nh.advertise&lt;topic_demo::gps&gt;(<span class="string">"gps_info"</span>,<span class="number">1</span>);</span><br><span class="line">	ros::<span class="function">Rate <span class="title">loop_rate</span><span class="params">(<span class="number">1.0</span>)</span></span>;</span><br><span class="line">	<span class="keyword">while</span>(ros::ok())</span><br><span class="line">	{</span><br><span class="line">		msg.x = <span class="number">1.3</span>*msg.x;</span><br><span class="line">		msg.y = <span class="number">1.2</span>*msg.y;</span><br><span class="line">		ROS_INFO(<span class="string">"talker: GPS x = %f, y = %f"</span>,msg.x, msg.y);</span><br><span class="line">		pub.publish(msg);</span><br><span class="line">		loop_rate.sleep();	</span><br><span class="line">	}</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table>

首先，我们要对`ros::init`传入argc，argv参数，以及这个Node的名称，并且通过`ros::NodeHandle`建立句柄，这是建立Node都需要的步骤。接下来定义了一个gps变量，通过句柄的advertise来得到publisher，之后也可以看到，subscriber，server还有client等等都是通过这个handle得到的。从publisher也可以看出topic名称为gps\_info。接下来的ros::Rate是一个控制频率的类，上述代码表示频率是1Hz，也就是一秒发送一下。之后的内容也很简单，就是简单发送的过程。上述代码实现了一个一秒发送一次位置信息的Node。

<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//content of listener.cpp</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;topic_demo/gps.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;std_msgs/Float32.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gpsCallBack</span><span class="params">(<span class="keyword">const</span> topic_demo::gps::ConstPtr &amp;msg)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">std_msgs::Float32 distance;</span><br><span class="line">distance.data = <span class="built_in">sqrt</span>(msg-&gt;x*msg-&gt;x + msg-&gt;y * msg-&gt;y);</span><br><span class="line">ROS_INFO(<span class="string">"listener: Distance to origin = %f, state = %s"</span>, distance.data, msg-&gt;state.c_str());</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">ros::init(argc,argv,<span class="string">"listener"</span>);</span><br><span class="line">ros::NodeHandle n;</span><br><span class="line">ros::Subscriber sub = n.subscribe(<span class="string">"gps_info"</span>,<span class="number">1</span>,gpsCallBack);</span><br><span class="line">ros::spin();<span class="comment">//反复执行,阻塞</span></span><br><span class="line"><span class="comment">//ros::spinOnce();//非阻塞</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table>

对于订阅者，首先需要一个回调函数，也就是收到信息后做的事情，这个被定义在`gpsCallBack`中。值得注意的是函数`ros::spin`，只有代码中使用了这个函数，回调函数才会被执行，这个是一定要记住的。`ros::spin`是一个阻塞函数，也就是当没有收到消息，进程会被阻塞而非继续执行之后的内容。另外一个类似的`ros::spinOnce`，在收到消息执行一次回调函数后，就会执行之后的内容了。

在做完这些之后，还需要修改CMakeLists.txt，需要修改或添加：  

<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">find_package(catkin REQUIRED COMPONENTS</span><br><span class="line">  message_generation</span><br><span class="line">  roscpp</span><br><span class="line">  rospy</span><br><span class="line">  std_msgs</span><br><span class="line">)</span><br><span class="line">add_message_files(</span><br><span class="line">   FILES</span><br><span class="line">   gps.msg</span><br><span class="line">)</span><br><span class="line">generate_messages(</span><br><span class="line">   DEPENDENCIES</span><br><span class="line">   std_msgs</span><br><span class="line">)</span><br><span class="line">add_executable(talker src/talker.cpp)</span><br><span class="line">add_dependencies(talker topic_demo_generate_messages_cpp)</span><br><span class="line">target_link_libraries(talker ${catkin_LIBRARIES})</span><br><span class="line"></span><br><span class="line">add_executable(listener src/listener.cpp)</span><br><span class="line">add_dependencies(listener topic_demo_generate_messages_cpp)</span><br><span class="line">target_link_libraries(listener ${catkin_LIBRARIES})</span><br></pre></td></tr></tbody></table>

同时对package.xml也进行修改：  

<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">buildtool_depend</span>&gt;</span>catkin<span class="tag">&lt;/<span class="name">buildtool_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build_depend</span>&gt;</span>roscpp<span class="tag">&lt;/<span class="name">build_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build_depend</span>&gt;</span>rospy<span class="tag">&lt;/<span class="name">build_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build_depend</span>&gt;</span>std_msgs<span class="tag">&lt;/<span class="name">build_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build_depend</span>&gt;</span>message_generation<span class="tag">&lt;/<span class="name">build_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build_export_depend</span>&gt;</span>roscpp<span class="tag">&lt;/<span class="name">build_export_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build_export_depend</span>&gt;</span>rospy<span class="tag">&lt;/<span class="name">build_export_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build_export_depend</span>&gt;</span>std_msgs<span class="tag">&lt;/<span class="name">build_export_depend</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>roscpp<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>rospy<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>std_msgs<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>message_runtime<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br></pre></td></tr></tbody></table>

最后，回到workspace目录，输入`catkin_make`编译，使用`rosrun pkg_name node_name`来运行node。如果找不到package，看是不是没有将package加入环境变量，可以使用`source workspace/devel/setup.bash`命令来做到这一点。

### [](about:blank#Service "Service")Service

下面是一个Service的实例，与topic是很类似的。同样建立service\_demo的package，添加依赖项。我们编写一个客户端与服务端打招呼的简单实例，将这个服务命名为greeting。在src下有两个源代码：server.cpp，client.cpp。同时记着要编写一个Greeting.srv，也就是service的数据格式：  

<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#content of Greeting.srv</span><br><span class="line">string name</span><br><span class="line">int32 age</span><br><span class="line">---</span><br><span class="line">string feedback</span><br></pre></td></tr></tbody></table>

经过编译后，上述文件会在devel/include/service\_demo/目录下生成Greeting.h，GreetingRequest.h，GreetingResponse.h三个头文件。不过Greeting.h中就include了后面二者，因此无需重复include。

下面分别是server.cpp与client.cpp的内容。  

<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//content of server.cpp</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;service_demo/Greeting.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">handleFuntion</span><span class="params">(service_demo::Greeting::Request &amp;req, service_demo::Greeting::Response &amp;res)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    ROS_INFO(<span class="string">"Request from %s, age %d"</span>, req.name.c_str(), req.age);</span><br><span class="line">    res.feedback=<span class="string">"Hi, "</span>+req.name+<span class="string">"."</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">ros::init(argc,argv,<span class="string">"greeting_server"</span>);</span><br><span class="line">ros::NodeHandle nh;</span><br><span class="line">ros::ServiceServer service = nh.advertiseService(<span class="string">"greeting"</span>,handleFuntion);</span><br><span class="line">ros::spin();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table>

<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//content of client.cpp</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;service_demo/Greeting.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    ros::init(argc, argv, <span class="string">"greeting_client"</span>);</span><br><span class="line">    ros::NodeHandle n;</span><br><span class="line">    ros::ServiceClient client = n.serviceClient&lt;service_demo::Greeting&gt;(<span class="string">"greeting"</span>);</span><br><span class="line">    service_demo::Greeting srv;</span><br><span class="line">    srv.request.name=<span class="string">"wlsdzyzl"</span>;</span><br><span class="line">    srv.request.age = <span class="number">23</span>;</span><br><span class="line">    <span class="keyword">if</span>(client.call(srv))</span><br><span class="line">    {</span><br><span class="line">        ROS_INFO(<span class="string">"Feedback from server :%s"</span>, srv.response.feedback.c_str());</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">        ROS_ERROR(<span class="string">"Failed to call service."</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table>

最后，对CMakeLists.txt与package.xml做类似的修改，实际上修改是很容易的，因为生成package时候给了模板和注释内容，仔细阅读取消对应注释，修改名称即可。

[](about:blank#rospy "rospy")rospy
----------------------------------

python的写法与cpp还是有很大不同的，但是一般来说python的写法更简单。下面我们将用python写两个功能与上述cpp实例一样的实例。

### [](about:blank#Topic-1 "Topic")Topic

对于\*.msg文件的内容我们无需改动。在新建package（topic\_demo\_py）之后，新建目录scripts，用来存放python脚本。新建pytalker.py与pylistener.py两个文件，内容分别如下：  

<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># content of pytalker.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">from</span> topic_demo_py.msg <span class="keyword">import</span> gps</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">talker</span><span class="params">()</span>:</span></span><br><span class="line"></span><br><span class="line">    pub = rospy.Publisher(<span class="string">'gps_info'</span>,gps,queue_size=<span class="number">1</span>)</span><br><span class="line">    rospy.init_node(<span class="string">'pytalker'</span>,anonymous=<span class="keyword">True</span>)</span><br><span class="line">    rate = rospy.Rate(<span class="number">1</span>)</span><br><span class="line">    x=<span class="number">1.2</span></span><br><span class="line">    y=<span class="number">1.3</span></span><br><span class="line">    state = <span class="string">"working"</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line">        rospy.loginfo(<span class="string">"talker x = %f, y = %f"</span>,x,y)</span><br><span class="line">        pub.publish(gps(x,y,state))</span><br><span class="line">        x = math.pow(x,<span class="number">2</span>)</span><br><span class="line">        y = math.pow(y,<span class="number">2</span>)</span><br><span class="line">        rate.sleep()</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    talker()</span><br></pre></td></tr></tbody></table>

这里的代码也是很容易理解的，基本看字面就能知道意思，值得一提的是anonymous参数，这确保了结点名称的唯一性，通过对前面的NAME后添加随机数字。而第一行的注释：  

<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br></pre></td></tr></tbody></table>

是每个python编写的ros脚本之前都需要加的，表明这个脚本按照python执行。下面是pylistener.py的内容：  

<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># content of pylistener.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">from</span> topic_demo_py.msg <span class="keyword">import</span> gps</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">callback</span><span class="params">(gps)</span>:</span></span><br><span class="line">    distance = math.sqrt(math.pow(gps.x,<span class="number">2</span>)+math.pow(gps.y,<span class="number">2</span>))</span><br><span class="line">    rospy.loginfo(<span class="string">"distance = %f, state = %s"</span>,distance,gps.state)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">listener</span><span class="params">()</span>:</span></span><br><span class="line">    rospy.init_node(<span class="string">'pylistener'</span>)</span><br><span class="line">    rospy.Subscriber(<span class="string">'gps_info'</span>,gps,callback)</span><br><span class="line">    rospy.spin()</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    listener()</span><br></pre></td></tr></tbody></table>

最后还需要注意的是，尽管python是脚本应当可以直接执行，但是观察上面代码我们发现一行`from topic_demo_py.msg import gps`，这个是需要message\_generation生成的，因此我们依然需要对CMakeLists.txt（不需要生成可执行文件的部分）与package.xml进行改动，用来生成python需要的包。

最后，在进行`catkin_make`与`source workspace/devel/setup.bash`之后，就可以通过下面的命令来启动结点了：  

<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun pkg_name pyscript.py</span><br></pre></td></tr></tbody></table>

这时候如果你是ubuntu，可能发现执行不成功，因为我们编写的python脚本没有可执行的权限，需要使用下面的命令增加权限：  

<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x pyscript.py</span><br></pre></td></tr></tbody></table>

接下来应该就正常了。

### [](about:blank#Service-1 "Service")Service

对于Service来说，基本上也是一致的。除了编译后会生成多个需要引入的包，为了方便我们使用\*来全部引入，下面就只贴出代码，其他的不过多介绍了。  

<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># content of pyserver.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> service_demo_py.srv <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_function</span><span class="params">(req)</span>:</span></span><br><span class="line">    rospy.loginfo(<span class="string">"name: %s, age: %d"</span>,req.name,req.age)</span><br><span class="line">    <span class="keyword">return</span> GreetingResponse(<span class="string">"Hi, "</span>+req.name)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">server</span><span class="params">()</span>:</span></span><br><span class="line">    rospy.init_node(<span class="string">"pyservice"</span>)</span><br><span class="line">    srv = rospy.Service(<span class="string">"greeting"</span>,Greeting,handle_function)</span><br><span class="line">    rospy.spin()</span><br><span class="line"><span class="keyword">if</span> __name__ ==<span class="string">"__main__"</span>:</span><br><span class="line">    server()</span><br></pre></td></tr></tbody></table>

```
# content of pyclient.py
#!/usr/bin/env python

import rospy
from service_demo_py.srv import *

def client():
    rospy.init_node("pyclient")
    #rospy.wait_for_service("greeting")
    name = 'wlsdzyzl'
    age = 23
    req = GreetingRequest(name,age)
    cl = rospy.ServiceProxy("greeting",Greeting)
    resp= cl(req)
    rospy.loginfo(resp.feedback)
if __name__ == "__main__":
    client()

```